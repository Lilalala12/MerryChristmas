<!DOCTYPE HEML PUBLIC>
<html>
    <head>
    <meta charset="utf-8">
        <style>
            html, body
            {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                border: 0;
            }
            
            div
            {
                margin: 0;
                padding: 0;
                border: 0;
            }
            .nav
            {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 27px;
                background-color: white;
                color: black;
                text-align: center;
                line-height: 25px;
            }
            a
            {
                color: black;
                text-decoration: none;
                border-bottom: 1px dashed black;
            }
            a:hover
            {
                border-bottom: 1px solid red;
            }
            .previous
            {
                float: left;
                margin-left: 10px;
            }
            .next
            {
                float: right;
                margin-right: 10px;
            }
            .green
            {
                color: green;
            }
            .red
            {
                color: red;
            }
            textarea
            {
                width: 100%;
                height: 100%;
                border: 0;                
                padding: 0;                
                margin: 0;                
                padding-bottom: 20px;              
            }            
            .block-outer            
            {                
                float: left;                
                width: 22%;                
                height: 100%;                
                padding: 5px;                
                border-left: 1px solid black;                
                margin: 30px 3px 3px 3px;                
            }            
            .block-inner            
            {                
                height: 68%;                
            }            
            .one            
            {                
                border: 0;                
            }
            #c {
                        position: absolute;
                        left: 0px;
                        top: 0px;
                        margin: 0px;
                    }

            #d {
                position: absolute;
                left: 0px;
                top: 0px;
                margin: 0px;
            }
            h1 {
                width: 40rem;
                font-family: "华文行楷";
                font-size: 6rem;
                color: red;
                /*text-align: center;*/
                position: absolute;
                left: 10%;
                top: 100;
                margin-left: 10;
            }
            /* 触发弹窗图片的样式 */
            #myImg {
                border-radius: 5px;
                cursor: pointer;
                transition: 0.3s;
            }
             
            #myImg:hover {opacity: 0.7;}
             
            /* 弹窗背景 */
            .modal {
                display: none; /* Hidden by default */
                /*position: fixed; /* Stay in place */*/
                z-index: 1; /* Sit on top */
               /* padding-top: 0;  Location of the box */
                margin: 0 auto;
                max-width: 700px;
                /*left: 100;
                top: 50;
                right: 50;
                bottom: 50;*/
                /*width: 100%; /* Full width */
                /*height: 100%; /* Full height */
                /* overflow: auto; Enable scroll if needed */
                background-color: rgb(0,0,0); /* Fallback color */
                background-color: rgba(0,0,0,0.0); /* Black w/ opacity */
            }
             
            /* 图片 */
            .modal-content {
                margin: 0 auto;
                display: block;
                /*height: 100%;
                width: 100%;*/
                max-width: 700px;
                max-height: 600px;
            }
                          
            /* 添加动画 */
            .modal-content, #caption { 
                -webkit-animation-name: zoom;
                -webkit-animation-duration: 0.6s;
                animation-name: zoom;
                animation-duration: 0.6s;
            }
             
            @-webkit-keyframes zoom {
                from {-webkit-transform:scale(0)} 
                to {-webkit-transform:scale(1)}
            }
             
            @keyframes zoom {
                from {transform:scale(0)} 
                to {transform:scale(1)}
            }
             
            /* 关闭按钮 */
            .close {
                position: absolute;
                /*top: 15px;
                right: 35px;*/
                margin: 0 auto;
                color: lightgreen;
                font-size: 66px;
                font-weight: bold;
                transition: 0.3s;
            }
             
            .close:hover,
            .close:focus {
                color: #bbb;
                text-decoration: none;
                cursor: pointer;
            }
             
            /* 小屏幕中图片宽度为 100% */
            @media only screen and (max-height: 600px){
                .modal-content {
                    /*width: 100%;*/
                }
            }
        </style>      
    </head>      
<body background="./source/img/bg.jpg" style=" background-repeat:no-repeat;background-size:100% 100%;"> 

    <div>
        <h1>&nbsp;&nbsp;&nbsp;&nbsp;涵菁</br>Merry Christmas</h1>
        <!----><canvas id="d" ></canvas>
        <!-- <canvas id="c" style="position:absolute;z-index:-1;"></canvas>  -->
        <canvas id="canvas">Canvas is not supported in your browser.</canvas>
        <!-- 弹窗 -->
        <div id="myModal" class="modal">
         
          <!-- 关闭按钮 -->
          <span class="close" onclick="document.getElementById('myModal').style.display='none'">&times;</span>
         
          <!-- 弹窗内容 -->
          <img class="modal-content" id="img01">
        </div>
    </div>
    <script>              
        var collapsed = true; 
        var file_path = './source/img/';           
        function toggle()            
        {                  
            var fs = top.document.getElementsByTagName('frameset')[0];                
            var f = fs.getElementsByTagName('frame');                
            if (collapsed)                
            {                      
                fs.rows = '250px,*';                    
                fs.noResize = false;                    
                f[0].noResize = false;                      
                f[1].noResize = false;
            }                 
            else
            {                      
                fs.rows = '30px,*';
                fs.noResize = true;
                f[0].noResize = true;
                f[1].noResize = true;
            }                  
            collapsed = !collapsed;            
        }
    </script>  

    <script>              
        var b = document.body;            
        var c = document.getElementsByTagName('canvas')[0];            
        var a = c.getContext('2d');            
        document.body.clientWidth;
    </script>  
    <script>
        // console.log(window.innerWidth);
        // console.log(window.innerHeight);
        var Width=window.innerWidth;
        var Height=window.innerHeight;
        M=Math;
        Q=M.random;J=[];
        U=16;
        T=M.sin;
        E=M.sqrt;
        for(O=k=0;x=z=j=i=k<150;)
        with(M[k]=k?c.cloneNode(0):c)
        {    
            width=k?32:W= Width;
            height=k?32: Height;       
            with(getContext('2d'))        
            if(k>10|!k)        
            for(        
            font='50px Impact',        
            V='rgba(';I=i*U,fillStyle=k?k==13?V+'205,205,215,.15)':        
            V+(147+I)+','+(k%2?128+I:0)+','+I+',.5)':'#cca',i<7;        
            )    
            beginPath(        
            fill(            
            arc(                
            U-i/3,                
            24-i/2,                
            k==13?4-(i++)/2:8-i++,                
            0,                
            M.PI*2,1                
            )            
            )            
            );
            else for(;
            x=T(i),        
            y=Q()*2-1,        
            D=x*x+y*y,        
            B=E(D-x/.9-1.5*y+1),        
            R=80*(B+1)*(L=k/9+.8)>>1,        
            i++<W;        
            )
            if(D<1)    
            beginPath(        
            strokeStyle=V+R+','+(R+B*L>>0)+',40,.1)'        
            ),        
            moveTo(U+x*8,U+y*8),        
            lineTo(U+x*U,U+y*U),        
            stroke();
            for(        
            y=H=k+E(k++)*25,        
            R=Q()*W;        
            P=3,j<H;        
            )    
            J[O++]=[x+=T(R)*P+Q()*6-3,y+=Q()*U-8,z+=T(R-11)*P+Q()*6-3,j/H*20+((j+=U)>H&Q()>.8?Q(P=9)*4:0)>>1]
        }
        setInterval(function G(m,l)
        {    
            A=T(D-11);    
            if(l)
            return(        
            m[2]-l[2])*A+(l[0]-m[0])*T(D);        
            a.clearRect(0,0,W,W);        
            J.sort(G);
            for(        
            i=0;        
            L=J[i++];       
            a.drawImage        
            (            
            M[L[3]+1],100+L[0]*A+L[2]*T(D)>>0,Height*0.6+(L[1]>>1))    )    
            {   
                if(!(i%7))        
                a.drawImage        
                (
                M[13],
                ((157*(i*i)+T(D*5+i*i)*5)%W)>>0,
                ((113*i+(D*i)/60)%(Height+i/99))>>0
                );
            }    
            D+=.02
        },1)
    </script>
    <!--<script>
    var canvas = document.getElementsByTagName('canvas')[1];
    var ctx = canvas.getContext('2d');
    ctx.fillStyle = 'rgba(255, 255, 255, 0)';
    //console.log('./'+file_path+'aixin'+i+'.png');
    var wW = Width;
    var wH = Height;
    var Na = 1;
    var Nx = 2;
    var num1=14 //红心数
    var num =27; //飞行物总数
    var heartImages = [];
    for(let i=0; i<Na; ++i){
        heartImages.push(new Image());
        heartImages[i].src = file_path+'aixin'+i+'.png';
    }
    for(let i=0; i<Nx; ++i) {
        heartImages.push(new Image());
        heartImages[i+Na].src = file_path+'xinfeng'+i+'.png';
    }
    heartImages.push(new Image());
    heartImages[Na+Nx].src = file_path+'gift.png';
    var hearts=[]; //心的数组
    init(); //运行初始化函数

    function init (){ //初始化画布的大小
        canvas.width = wW;
        canvas.height = wH;
        for(var i=0; i<num; i++){
            if(i<num1) hearts.push(new Heart(0));
            else hearts.push(new Heart(1));
        }
        hearts.push(new Heart(0));
        hearts[num].p = Nx+Na;
        hearts[num].x=60;
        hearts[num].y=160;
        hearts[num].opacity=1;
        hearts[num].scale=hearts[num].targetScal;
        hearts[num].width = hearts[num].scale * hearts[num].initialW;
        hearts[num].height = hearts[num].scale * hearts[num].initialH;
        window.addEventListener('resize', function(){
            wW = window.innerWidth;
            wH = window.innerHeight;
        });
    }


    function Heart(type){   //构造函数
        this.x = Math.random() * wW;
        this.y = Math.random() * wH;
        this.opacity = Math.random() * .5 + .5;
        this.vel = {   //位移参数 移动量和方向
            x: (Math.random()-.5) * 2,
            y: (Math.random()-.5) * 2,
        };
        if(type==0) {
            this.p =Math.floor(Math.random() * Na);
        }else {
            this.p =Na + Math.floor(Math.random() * Nx);
        }
        this.initialW = 470;
        this.initialH = 410;
        this.initialW*.3;
        this.initialH*.3;
        this.targetScal = Math.random() * .1 + .15;  //最终大小缩放比例
        this.scale = this.targetScal * Math.random();

    }
        Heart.prototype.update = function(){
            if (this.p==Nx+Na) return;
            let randx = Math.random();
            let randy = Math.random();
            this.x +=randx>0.01? this.vel.x:-this.vel.x;
            this.y +=randy>0.01? this.vel.y:-this.vel.y;

            if(this.x - this.width > 0.8*wW || this.x + this.width < 0.2*wW){
                this.scale = 0; //重置缩放值
                this.x = Math.random() * wW;
                this.y = Math.random() * wH;
            }
            if(this.y - this.height > 0.8*wH || this.y + this.height < 0.2*wH){
                this.scale = 0; //重置缩放值
                this.x = Math.random() * wW;
                this.y = Math.random() * wH;
            }

            this.scale += (this.targetScal - this.scale) * .1; //慢慢放大
            this.width = this.scale * this.initialW;
            this.height = this.scale * this.initialH;
            };

        Heart.prototype.draw = function(){
            ctx.globalAlpha = this.opacity;
            ctx.drawImage(heartImages[this.p], this.x, this.y, this.width, this.height)
        };
    function showHeart(){
        ctx.clearRect(0, 0, wW, wH); //清空画布
        var tmp=num-1;
        if(!flag) {
            ctx.moveTo(100,70);
            ctx.lineTo(100,200);
            ctx.lineWidth=1;
            ctx.strokeStyle="red";
            ctx.stroke();
            tmp=num;
        }
        for(var i=0; i<=tmp; i++){
            hearts[i].update();
            hearts[i].draw();
        }
        setTimeout(showHeart,100);
    }
    var flag = false;
    // function setFlag(){
    //     //console.log(flag);
    //     flag = !flag;
    //     setTimeout(setFlag,5000);
    // }
    // setFlag();
    showHeart();
    var modal = document.getElementById('myModal');
    var modalImg = document.getElementById("img01");
    //modal.style.display = "block";
    // c.addEventListener('click', function(){
    //     var rect = d.getBoundingClientRect();
    //     var x = event.clientX - rect.left * (canvas.width / rect.width);
    //     var y = event.clientY - rect.top * (canvas.height / rect.height);

    //     if(!flag && Math.sqrt(Math.pow((x-hearts[num].x),2)+Math.pow((y-hearts[num].y),2))<80){
    //         var randg = Math.floor(Math.random() * 4);
    //         modalImg.src = file_path+'gift'+randg+'.png';
    //         modal.style.display = "block";
    //         return;
    //     }
    //     // console.log("x:"+x);
    //     // console.log("y:"+y);
    //     for(var i=0; i<num; ++i) {
    //         //console.log(hearts[i].x);
    //         var dist = Math.sqrt(Math.pow((x-hearts[i].x),2)+Math.pow((y-hearts[i].y),2));
    //         if(dist < 80) {
    //             if(i<num1) modalImg.src = file_path+'xiangk'+i+'.png';
    //             else modalImg.src = file_path+'xinzhi'+(i-num1)+'.png';
    //             modal.style.display = "block";
    //             return;
    //         }
    //     }
    // })
</script>-->

    <script type="text/javascript">
        window.requestAnimationFrame = (function(){
            return window.requestAnimationFrame ||
                   window.webkitRequestAnimationFrame ||
                   window.mozRequestAnimationFrame ||
                   function(callback){
                        window.setTimeout(callback,1000/80);
                   }
        })();

        var canvas = document.getElementById("canvas"),
            ctx = canvas.getContext("2d"),
            cw = window.innerWidth,
            ch = window.innerHeight,
            fireworks = [],
            particles = [],
            hue = 120,
            timerTotal = 10,
            timerTick = 0;

        canvas.width = cw;
        canvas.height = ch;


        function random(min,max){
            return Math.random()*(max-min)+min;
        }

        function caculateDistance(sx,sy,tx,ty){
            var xDistance = sx-tx,
                yDistance = sy-ty;
            return Math.sqrt(Math.pow(xDistance,2)+Math.pow(yDistance,2));
        }

        function Firework(sx,sy,tx,ty){
            this.x = sx;
            this.y = sy;
            this.sx = sx;
            this.sy = sy;
            this.tx= tx;
            this.ty = ty;
            this.distanceToTarget = caculateDistance(sx,sy,tx,ty);
            this.distanceTraveled = 0;
            this.coordinates = [];
            this.coordinatesCount = 3;
            while(this.coordinatesCount--){
                this.coordinates.push([this.x,this.y]);
            }
            this.angle = Math.atan2(ty-sy,tx-sx);
            this.speed = 10;
            this.acceleration = 1.05
            this.brightness = random(50,70);
            this.targetRadius = 1;
        }

        Firework.prototype.update = function(index){
            this.coordinates.pop();
            this.coordinates.unshift([this.x,this.y]);

            if(this.targetRadius<8) {
                this.targetRadius += 0.3;
            } else {
                this.targetRadius = 1;
            }
            this.speed *= this.acceleration;
            var vx = Math.cos(this.angle)*this.speed,
                vy = Math.sin(this.angle)*this.speed;
            this.distanceTraveled = caculateDistance(this.sx,this.sy,this.x+vx,this.y+vy);
            if(this.distanceTraveled>=this.distanceToTarget){
                createParticles(this.tx,this.ty);
                fireworks.splice(index,1);
            }else{
                this.x += vx;
                this.y += vy;
            }
        }

        Firework.prototype.draw = function(){

            ctx.beginPath();
            ctx.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]);
            ctx.lineTo(this.x,this.y);
            ctx.strokeStyle = 'hsl('+hue+',100%,'+this.brightness+'%)';
            ctx.stroke();

            ctx.beginPath();
            ctx.arc(this.tx,this.ty,this.targetRadius,0,Math.PI*2);
            ctx.stroke();
        }

        function Particle(x,y){
            this.x = x;
            this.y = y;
            this.coordinates = [];
            this.coordinatesCount = 5;
            while(this.coordinatesCount--){
                this.coordinates.push([this.x,this.y]);
            }
            this.angle = random(0,2*Math.PI);
            this.speed = random(1,5);
            this.friction = 0.95
            this.gravity = 1;
            this.hue = random(hue-20,hue+20);
            this.brightness = random(40,70);
            this.alpha = 1;
            this.decay = random(0.001,0.002);
        }

        Particle.prototype.update = function(index){
            this.coordinates.pop();
            this.coordinates.unshift([this.x,this.y]);
            this.speed *= this.friction;
            this.x += Math.cos(this.angle) * this.speed;
            this.y += Math.sin(this.angle) * this.speed + this.gravity;
            this.alpha -= this.decay;
            if(this.alpha<=this.decay){
                particles.splice(index,1);
            }
        }

        Particle.prototype.draw = function(){
            ctx.beginPath();
            ctx.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]);
            ctx.lineTo(this.x,this.y);
            ctx.strokeStyle = 'hsla('+this.hue+',100%,'+this.brightness+'%,'+this.alpha+')';
            ctx.stroke();
        }

        function createParticles(x,y){
            var particleCount = 100;
            while(particleCount--) {
                particles.push(new Particle(x,y));
            }
        }

        function loop(){
            requestAnimationFrame(loop);
            hue += 0.5;
            ctx.globalCompositeOperation = 'destination-out';
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect( 0, 0, cw, ch );
            ctx.globalCompositeOperation = 'lighter';
            var i = fireworks.length;
            while(i--) {
                fireworks[i].draw();
                fireworks[i].update(i);
            }
            var i = particles.length;
            while(i--) {
                particles[i].draw();
                particles[i].update(i);
            }
            if(timerTick >= timerTotal) {
                fireworks.push(new Firework(cw/2,ch,random(0,cw),random(0,ch/2)));
                timerTick = 0;
            } else {
                timerTick++;
            }
        }
        window.onload = loop;
    </script>
</body>
</html>
